Addresses:
- service:
    hostname: webhook.default.svc.cluster.local
    name: webhook
    namespace: default
    ports:
    - servicePort: 80
Backends:
- ai:
    providerGroups:
    - providers:
      - name: backend
        openai:
          model: gpt-4o-mini
  key: default/openai
  name:
    name: openai
    namespace: default
Binds:
- key: 8080/default/example-gateway
  port: 8080
Listeners:
- bindKey: 8080/default/example-gateway
  key: default/example-gateway.http
  name:
    gatewayName: example-gateway
    gatewayNamespace: default
    listenerName: http
  protocol: HTTP
Policies:
- backend:
    ai:
      defaults:
        array_int: '[1,2,3]'
        array_string: '["one","two","three"]'
        frequency_penalty: "0.1"
        presence_penalty: "0.1"
        string: '"some_string"'
        top_p: "0.95"
      modelAliases:
        default: gpt-4o-mini
        fast: gpt-3.5-turbo
        smart: gpt-4-turbo
      overrides:
        max_tokens: "2000"
        temperature: "0.5"
      promptGuard:
        request:
        - rejection:
            body: WW91ciByZXF1ZXN0IHdhcyByZWplY3RlZCBkdWUgdG8gaW5hcHByb3ByaWF0ZSBjb250ZW50
            status: 403
          webhook:
            backend:
              port: 80
              service:
                hostname: webhook.default.svc.cluster.local
                namespace: default
            forwardHeaderMatches:
            - exact: bar
              name: x-foo
            - name: x-baz
              regex: ^baz-.*
        - regex:
            action: REJECT
            rules:
            - regex: (?i)(hate|kill|harm)
            - regex: (?i)(bad|words)
            - builtin: CREDIT_CARD
            - builtin: SSN
        - openaiModeration:
            inlinePolicies:
            - auth:
                key:
                  secret: mysecretkey
            model: text-moderation-latest
        response:
        - webhook:
            backend:
              port: 80
              service:
                hostname: webhook.default.svc.cluster.local
                namespace: default
        - regex:
            action: MASK
            rules:
            - regex: \b\d{4}\b
            - regex: (?i)(password|secret)
            - builtin: EMAIL
            - builtin: PHONE_NUMBER
      prompts:
        append:
        - content: Please provide a concise response.
          role: user
        prepend:
        - content: You are a helpful assistant. Always be polite and professional.
          role: system
        - content: Remember to follow company guidelines.
          role: system
  key: backend/default/ai-policy:ai:default/openai-test
  name:
    kind: AgentgatewayPolicy
    name: ai-policy
    namespace: default
  target:
    route:
      name: openai-test
      namespace: default
Routes:
- backends:
  - backend:
      backend: default/openai
    weight: 1
  key: default/openai-test.0.0.http
  listenerKey: default/example-gateway.http
  matches:
  - path:
      pathPrefix: /v1/chat/completions
  name:
    kind: HTTPRoute
    name: openai-test
    namespace: default
